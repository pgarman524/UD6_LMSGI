<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Chapter&nbsp;4.&nbsp;Getting started</title><link rel="stylesheet" href="html.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.73.1"><link rel="start" href="index.html" title="Qizx Manual"><link rel="up" href="admin_guide.html" title="Part&nbsp;II.&nbsp;User's Guide"><link rel="prev" href="admin_guide.html" title="Part&nbsp;II.&nbsp;User's Guide"><link rel="next" href="server.html" title="Chapter&nbsp;5.&nbsp;Installing and Using Qizx Server"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter&nbsp;4.&nbsp;Getting started</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="admin_guide.html">Prev</a>&nbsp;</td><th width="60%" align="center">Part&nbsp;II.&nbsp;User's Guide</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="server.html">Next</a></td></tr></table><hr></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="getting_started"></a>Chapter&nbsp;4.&nbsp;Getting started</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="getting_started.html#d0e481">1. Introduction</a></span></dt><dd><dl><dt><span class="section"><a href="getting_started.html#d0e571">1.1. About the data samples used in this tutorial</a></span></dt></dl></dd><dt><span class="section"><a href="getting_started.html#plesson_crelib">2. Creating an XML Library</a></span></dt><dd><dl><dt><span class="section"><a href="getting_started.html#d0e667">2.1. Creating a Library using Qizx Studio</a></span></dt><dt><span class="section"><a href="getting_started.html#d0e780">2.2. Creating a Library using the qizx command-line tool</a></span></dt></dl></dd><dt><span class="section"><a href="getting_started.html#plesson_populate">3. Populating a Library with Collections and Documents</a></span></dt><dd><dl><dt><span class="section"><a href="getting_started.html#d0e876">3.1. Importing XML Documents using Qizx Studio</a></span></dt><dt><span class="section"><a href="getting_started.html#d0e1046">3.2. Importing XML Documents using the qizx tool</a></span></dt></dl></dd><dt><span class="section"><a href="getting_started.html#plesson_export">4. Exporting Documents from an XML Library</a></span></dt><dd><dl><dt><span class="section"><a href="getting_started.html#d0e1095">4.1. Using Qizx Studio</a></span></dt><dt><span class="section"><a href="getting_started.html#d0e1136">4.2. Using the qizx command-line tool</a></span></dt></dl></dd><dt><span class="section"><a href="getting_started.html#plesson_query">5. Querying a Library</a></span></dt><dd><dl><dt><span class="section"><a href="getting_started.html#d0e1208">5.1. Writing and running queries with Qizx Studio</a></span></dt><dt><span class="section"><a href="getting_started.html#d0e1293">5.2. Running queries with the qizx command line tool</a></span></dt></dl></dd><dt><span class="section"><a href="getting_started.html#plesson_delete">6. Copying, Renaming, Deleting Documents and Collections</a></span></dt><dd><dl><dt><span class="section"><a href="getting_started.html#d0e1327">6.1. Using Qizx Studio</a></span></dt><dt><span class="section"><a href="getting_started.html#d0e1337">6.2. Using the qizx command-line tool</a></span></dt></dl></dd><dt><span class="section"><a href="getting_started.html#d0e1389">7. Updating XML Documents</a></span></dt><dt><span class="section"><a href="getting_started.html#plesson_addmeta">8. Using Metadata Properties</a></span></dt><dd><dl><dt><span class="section"><a href="getting_started.html#d0e1540">8.1. Properties in Qizx Studio</a></span></dt><dt><span class="section"><a href="getting_started.html#d0e1642">8.2. Properties in the qizx command-line tool</a></span></dt><dt><span class="section"><a href="getting_started.html#d0e1647">8.3. Extension functions for Property handling</a></span></dt><dt><span class="section"><a href="getting_started.html#d0e1695">8.4. Using property queries to restrict the search domain of a standard query</a></span></dt><dt><span class="section"><a href="getting_started.html#d0e1724">8.5. Custom indexes</a></span></dt></dl></dd></dl></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e481"></a>1.&nbsp;Introduction</h2></div></div></div><p>Qizx is a XML Query database engine designed to be embedded in a <span class="trademark">Java</span>&#8482; application &#8212; typically a Servlet. As such, it is primarily used as a class library (see the chapter <a class="link" href="programming.html" title="Chapter&nbsp;10.&nbsp;Programming with the Qizx API">Programming with the Qizx API</a> for an introduction).</p><p>To help experimenting with XML Query and XML databases and developing, Qizx also comes with two tools which make it easy to build a database, populate it with XML documents, and perform queries on this database, without programming &#8212; except of course in XML Query:</p><div class="variablelist"><dl><dt><span class="term"><a class="link" href="qizxstudio.html" title="Qizx Studio Help">Qizx Studio</a></span></dt><dd><p>A graphic tool featuring an explorer view for browsing the contents of a group of XML Libraries, plus a simple XML Query workbench with which you can write and execute XML Query scripts, and view the results.</p></dd><dt><span class="term"><a class="link" href="qizxtool.html" title="qizx">qizx</a></span></dt><dd><p>A command-line tool which can be used to create and maintain XML Libraries, or simply execute XML Query script files.</p></dd></dl></div><p>In this chapter you'll learn in 6 lessons how these two tools can be used to achieve the most common tasks:</p><div class="orderedlist"><ol type="1" compact><li><p><a class="link" href="getting_started.html#plesson_crelib" title="2.&nbsp;Creating an XML Library">Lesson 1:</a> how to create a database (called <em class="glossterm">XML Library</em>)</p></li><li><p><a class="link" href="getting_started.html#plesson_populate" title="3.&nbsp;Populating a Library with Collections and Documents">Lesson 2</a>: how to populate a database with <em class="glossterm">Collection</em>s and <em class="glossterm">Document</em>s.</p></li><li><p><a class="link" href="getting_started.html#plesson_export" title="4.&nbsp;Exporting Documents from an XML Library">Lesson 3:</a> how to extract copies of <em class="glossterm">Document</em>s stored in a database.</p></li><li><p><a class="link" href="getting_started.html#plesson_query" title="5.&nbsp;Querying a Library">Lesson 4:</a> how to query a database.</p></li><li><p><a class="link" href="getting_started.html#plesson_delete" title="6.&nbsp;Copying, Renaming, Deleting Documents and Collections">Lesson 5:</a> how to delete a <code class="interfacename">Document</code>, a <code class="interfacename">Collection</code> or a whole <code class="interfacename">Library</code>.</p></li><li><p><a class="link" href="getting_started.html#plesson_addmeta" title="8.&nbsp;Using Metadata Properties">Lesson 6:</a> how to use metadata (properties) on <em class="glossterm">Document</em>s or <em class="glossterm">Collections</em>.</p></li></ol></div><p>The target audience of this chapter are programmers or experienced users having a good knowledge of XML and at least a basic knowledge of XQuery.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e571"></a>1.1.&nbsp;About the data samples used in this tutorial</h3></div></div></div><p>The directory <a class="ulink" href="../samples/book_data/" target="_top"><code class="filename">docs/samples/book_data/</code></a> contains several kinds of XML documents. These short, simple XML documents (a few dozens) serve no other purpose than teaching how to use Qizx API. In real life, Qizx can be expected to store and query hundreds of thousands XML documents of multiple sizes, ranging from a few hundreds of bytes to several hundred megabytes.</p><div class="variablelist"><dl><dt><span class="term">Books/</span></dt><dd><p>Each document found in this directory contains the description of a Science-Fiction book: its title, authors, editions, etc. Example <a class="ulink" href="../samples/book_data/Books/The_Robots_of_Dawn.xml" target="_top"><code class="filename">docs/samples/book_data/Books/The_Robots_of_Dawn.xml</code></a>:</p><pre class="programlisting">&lt;book xmlns="http://www.qizx.com/namespace/Tutorial"&gt;
  &lt;title&gt;The Robots of Dawn&lt;/title&gt;
  &lt;author&gt;Isaac Asimov&lt;/author&gt;
  &lt;publicationDate&gt;MCMLXXXIII&lt;/publicationDate&gt;
  &lt;editions&gt;
    &lt;edition&gt;
      &lt;ISBN&gt;0553299492&lt;/ISBN&gt;
      &lt;publisher&gt;Doubleday&lt;/publisher&gt;
      &lt;language&gt;English&lt;/language&gt;
      &lt;year&gt;1983&lt;/year&gt;
    &lt;/edition&gt;
  &lt;/editions&gt;
&lt;/book&gt;</pre></dd><dt><span class="term">Publishers/</span></dt><dd><p>Each document found in this directory contains the description of a publisher: its name, address, etc. Example <a class="ulink" href="../samples/book_data/Publishers/Doubleday.xml" target="_top"><code class="filename">docs/samples/book_data/Publishers/Doubleday.xml</code></a>:</p><pre class="programlisting">&lt;publisher xmlns="http://www.qizx.com/namespace/Tutorial"&gt;
  &lt;trademark&gt;Doubleday&lt;/trademark&gt;
  &lt;company&gt;Random House, Inc.&lt;/company&gt;
  &lt;address xml:space="preserve"&gt;1540 Broadway
New York, NY 10036
US&lt;/address&gt;
&lt;/publisher&gt;</pre></dd><dt><span class="term">Authors/</span></dt><dd><p>Each document found in this directory contains the description of a Science-Fiction author: her/his name, pseudonyms, birth date, etc. Example <a class="ulink" href="../samples/book_data/Authors/iasimov.xml" target="_top"><code class="filename">docs/samples/book_data/Authors/iasimov.xml</code></a>:</p><pre class="programlisting">&lt;author xmlns="http://www.qizx.com/namespace/Tutorial"
  nationality="US" gender="male"&gt;
  &lt;fullName&gt;Isaac Asimov&lt;/fullName&gt;
  &lt;pseudonyms&gt;
    &lt;pseudonym&gt;Paul French&lt;/pseudonym&gt;
    &lt;pseudonym&gt;George E. Dale&lt;/pseudonym&gt;
  &lt;/pseudonyms&gt;
  &lt;birthDate&gt;January 2, 1920&lt;/birthDate&gt;
  &lt;birthPlace&gt;
    &lt;city&gt;Petrovichi&lt;/city&gt;&lt;country&gt;Russian SFSR&lt;/country&gt;
  &lt;/birthPlace&gt;
  &lt;blurb location="../Author%20Blurbs/Isaac_Asimov.xhtml"/&gt;
&lt;/author&gt;</pre></dd><dt><span class="term">Author Blurbs/qizx</span></dt><dd><p>Each document found in this directory is an XHTML page which is a copy of a <a class="ulink" href="http://wikipedia.org/" target="_top">Wikipedia</a> article describing a Science-Fiction author. Example <a class="ulink" href="../samples/book_data/Author%20Blurbs/Isaac_Asimov.xhtml" target="_top"><code class="filename">docs/samples/book_data/Author Blurbs/Isaac_Asimov.xhtml</code></a>:</p><pre class="programlisting">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;
&lt;html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" dir="ltr"
lang="en"&gt;
&lt;head&gt;
...
&lt;title&gt;Isaac Asimov - Wikipedia, the free encyclopedia&lt;/title&gt;
...
&lt;/body&gt;
&lt;/html&gt;</pre><p>The XHTML DTD and the corresponding <a class="ulink" href="http://xml.apache.org/commons/components/resolver/resolver-article.html" target="_top">XML Catalog</a> are found in <a class="ulink" href="../samples/xhtml_dtd/" target="_top"><code class="filename">docs/samples/xhtml_dtd/</code></a>.</p></dd></dl></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="plesson_crelib"></a>2.&nbsp;Creating an XML Library</h2></div></div></div><p>in Qizx, a database is called an <a class="glossterm" href="glossary.html#gloss_library"><em class="glossterm">XML Library</em></a>. Physically, a Library is stored in a directory on a disk. There is no limit to the number of Libraries that can be created with Qizx.</p><p>A Qizx engine can actually handle several Libraries at the same time. This allows a better sharing of resources in case an application needs to handle several Libraries.</p><p>A <a class="glossterm" href="glossary.html#gloss_library_group"><em class="glossterm">Library Group</em></a> is simply a bundle of Libraries grouped together inside a parent directory. A Library group can be opened or created in a single operation by a Qizx engine.</p><p>A Library is normally part of a Library Group. This not a hard and fast rule, a Library can be opened independently and can even belong to several groups<sup>[<a name="d0e658" href="#ftn.d0e658" class="footnote">1</a>]</sup>.</p><p>In practice, you will likely use a single Library at a time. It is rarely useful to create two or more Libraries, unless to really want to have separate sets of data for your applications; indexing issues can be a reason too (see the chapter <a class="link" href="indexing.html" title="Chapter&nbsp;9.&nbsp;Configuring the indexing process">Configuring the indexing process</a> for more details).</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e667"></a>2.1.&nbsp;Creating a Library using Qizx Studio</h3></div></div></div><h4><a name="d0e670"></a>Starting Qizx Studio</h4><div class="itemizedlist"><ul type="disc"><li><p>On Windows, the directory bin inside the Qizx distribution contains an executable <span class="command"><strong>qizxstudio.exe</strong></span> (or <span class="command"><strong>qizxstudio.bat</strong></span>), that can be started directly by a double-click,</p></li><li><p>On Linux or Mac&nbsp;OS&nbsp;X or other Unix, a shell script <span class="command"><strong>bin/qizxstudio</strong></span> can be started from a console window or from a graphic explorer.</p><p>Note that when started from a console, Qizx Studio accepts command-line arguments, for example to directly open a Library group or load a XML Query script in the editor. See the <a class="link" href="qizxstudio.html" title="Qizx Studio Help">reference documentation</a>.</p></li></ul></div><p>You should then see a window looking like this:</p><div class="figure"><a name="d0e695"></a><p class="title"><b>Figure&nbsp;4.1.&nbsp;Qizx Studio first launch</b></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="567"><tr><td><img src="resources/launch2.png" width="567" alt="Qizx Studio first launch"></td></tr></table></div></div></div></div><br class="figure-break"><div class="itemizedlist"><ul type="disc"><li><p>There are two tabs in Qizx Studio: "<span class="guilabel">XQuery</span>" for entering and running queries, "<span class="guilabel">XML Libraries</span>" for browsing and modifying XML Libraries.</p></li><li><p>The header <span class="guilabel">[No XML Libraries]</span> means that Qizx Studio has not yet opened any Library group. Still, it is possible to execute XQuery scripts but without access to a library.</p></li></ul></div><h4><a name="d0e718"></a>Creation of the Library</h4><div class="figure"><a name="d0e720"></a><p class="title"><b>Figure&nbsp;4.2.&nbsp;Creating an XML Library</b></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="567"><tr><td><img src="resources/createlib.png" width="567" alt="Creating an XML Library"></td></tr></table></div></div></div></div><br class="figure-break"><div class="orderedlist"><ol type="1"><li><p>Right-clicking on the icon of the library group icon and choosing "<span class="guimenuitem">Create Library Group</span>" brings a directory selection dialog with which you select a directory (new or empty), assumed here to be "<code class="filename">C:\works\xdb1</code>" (of course it can be whatever you choose).</p></li><li><p>Then the dialog above asks for the name of the first Library within the group. We assume in the following that the name "<code class="literal">scifi</code>" is chosen.</p></li><li><p>When the Library is created, it contains the root collection, whose path is "<code class="literal">/</code>". By clicking on the root collection, you should see its default Metadata properties appear on the right side.</p></li><li><p>It is possible to create more Libraries with the right-click menu on the icon of the Library Group.</p></li><li><p>Opening an existing Library Group is achieved by using the menu item "<span class="guimenuitem">Open XML Library Group</span>" and choosing its directory.</p><p>You can also directly choose the directory of a <span class="emphasis"><em>Library</em></span> (instead of a group), but in that case you can manage only this single library.</p><p>Note that a Library can be opened by only one instance of a Qizx engine at a time: if you attempt to open it several times you will get an error message complaining that the Library is locked.</p></li></ol></div><h4><a name="d0e765"></a>Creation of a Collection</h4><div class="orderedlist"><ol type="1"><li><p>Right-clicking on the icon of the root collection, and choosing "<span class="guimenuitem">Create sub-collection</span>", you are prompted for the name of a Collection (the name must not contain slashes). The collection is created as direct child of the root collection. If your chose the name "<code class="literal">books</code>", the path of the collection is "<code class="literal">/books</code>".</p></li></ol></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e780"></a>2.2.&nbsp;Creating a Library using the qizx command-line tool</h3></div></div></div><p>The shell script <code class="filename">qizx</code> (<code class="filename">qizx.bat</code> on Windows) is also located in the <code class="filename">bin/</code> directory in the Qizx distribution. In the following we assume that this <code class="filename">bin/</code> directory is in the <code class="envar">PATH</code> environment variable.</p><p>In a terminal window, type the following command (on Windows):</p><pre class="programlisting">qizx -group c:\works\xdb1 <a class="co" name="co_q1_group" href="getting_started.html#co_q1_group_id"><img src="images/callouts/1.png" alt="1" border="0"></a> -library scifi <a class="co" name="co_q1_lib" href="getting_started.html#co_q1_lib_id"><img src="images/callouts/2.png" alt="2" border="0"></a> -create <a class="co" name="co_q1_create" href="getting_started.html#co_q1_create_id"><img src="images/callouts/3.png" alt="3" border="0"></a></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a name="co_q1_group_id"></a><a href="#co_q1_group"><img src="images/callouts/1.png" alt="1" border="0"></a> </p></td><td valign="top" align="left"><p>The option <code class="option">-group</code> (or <code class="option">-g</code> for short) specifies the path of the Library group (here <code class="filename">c:\works\xdb1</code>)</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a name="co_q1_lib_id"></a><a href="#co_q1_lib"><img src="images/callouts/2.png" alt="2" border="0"></a> </p></td><td valign="top" align="left"><p>The option <code class="option">-library </code>(or <code class="option">-l</code> for short) specifies the name of the working Library (here <code class="literal">scifi</code>).</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a name="co_q1_create_id"></a><a href="#co_q1_create"><img src="images/callouts/3.png" alt="3" border="0"></a> </p></td><td valign="top" align="left"><p>The option <code class="option">-create</code> tells the tool to create what is necessary:</p><div class="itemizedlist"><ul type="disc" compact><li><p>If the group does not exist yet, then it is created</p></li><li><p>If the library <code class="literal">scifi</code> does not exist yet, then it is created</p></li><li><p>If both already exist, the <code class="option">-create</code> option has no effect.</p></li></ul></div></td></tr></table></div><p>If you explore the directory <code class="filename">c:\works\xdb1</code>, you will find a sub-directory corresponding to the Library <code class="literal">scifi</code>. The internal structure of a Library needs not be known, and should never be altered manually, except for the directories <code class="filename">logs</code> which contain log files.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="plesson_populate"></a>3.&nbsp;Populating a Library with Collections and Documents</h2></div></div></div><p>In this section we use the sample documents provided in <a class="ulink" href="../samples/book_data/" target="_top"><code class="filename">docs/samples/book_data/</code></a> inside the distribution.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e876"></a>3.1.&nbsp;Importing XML Documents using Qizx Studio</h3></div></div></div><p>Assuming we have created a Library named '<code class="literal">scifi</code>' as explained above:</p><div class="orderedlist"><ol type="1"><li><p>Right-click on the icon of the root collection (path '<code class="literal">/</code>') and choose <span class="guimenuitem">Import Documents</span>. A dialog appears.</p></li><li><p>The import operation is performed in two steps:</p><div class="orderedlist"><ol type="a"><li><p>Files and directories are selected in an import list, using the <span class="guibutton">Add File/Folder</span> button.</p><p>The Filter combo-box allows filtering the file extension of interest (generally <code class="literal">.xml</code>).</p><p>Here we select the whole directory <code class="filename">docs\samples\book_data</code> or <code class="filename">docs/samples/book_data</code> inside the Qizx distribution. Because we use the filter <code class="literal">*.xml</code>, only the files ending with the <code class="literal">.xml</code> extension will be selected. After selection the number of selected documents and their total size in bytes are displayed in the table.</p><p>This selection operation can be repeated on directories, or on single XML files. The auxiliary buttons <span class="guibutton">Remove</span> and <span class="guibutton">Clear all</span> allow editing the list.</p></li><li><p>Pushing the button <span class="guibutton">Start Import</span> actually starts the import transaction.</p><p>After completion, the dialog can be closed with the Close button at bottom.</p><p>Parsing errors are displayed in the message window of the dialog. The import speed can reach up to 2 Megabytes per second on a 3 GHz processor for large documents, but a large number of small documents can proportionally slow down this process.</p></li></ol></div></li><li><p>Once the import finished, you should see something like:</p><div class="figure"><a name="d0e944"></a><p class="title"><b>Figure&nbsp;4.3.&nbsp;Library browser after importing documents</b></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="567"><tr><td><img src="resources/importdone.png" width="567" alt="Library browser after importing documents"></td></tr></table></div></div></div></div><br class="figure-break"></li></ol></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Remark</h3><p>When selecting a directory in the import dialog, the <span class="emphasis"><em>contents</em></span> of the directory are imported into the current collection. The sub-directory structure of the source is replicated, but the original directory name is not used.</p></div><div class="sidebar"><a name="using_xml_catalogs"></a><p class="title"><b>XML catalogs</b></p><p>XML documents conforming to a DTD start with a <code class="literal">&lt;!DOCTYPE&gt;</code> looking like this:</p><pre class="programlisting">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;</pre><p>Qizx needs to parse a document in order to be able to import it in a database. The first step of parsing consists in downloading and parsing the DTD itself. If this first step fails, the whole import process fails too.</p><p>In the above example, the DTD, <code class="uri">http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd</code>, is found on a remote server. Downloading the DTD from this server works fine, but could make the import process very slow.</p><p>The solution to this problem is to use an <em class="firstterm">XML catalog</em>. To make it simple, an XML catalog is a file, using a very simple XML vocabulary, which associates the public ID of a DTD to the path of a local copy of this DTD:</p><pre class="programlisting">&lt;catalog xmlns="urn:oasis:names:tc:entity:xmlns:xml:catalog"
         prefer="public"&gt;
  ...
  &lt;public publicId="-//W3C//DTD XHTML 1.0 Transitional//EN"<a class="co" name="pxml_catalog_publicId" href="getting_started.html#pxml_catalog_publicId_2"><img src="images/callouts/1.png" alt="1" border="0"></a>
          uri="xhtml1-transitional.dtd"/&gt;<a class="co" name="pxml_catalog_uri" href="getting_started.html#pxml_catalog_uri_2"><img src="images/callouts/2.png" alt="2" border="0"></a>
  ...
&lt;/catalog&gt;</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a name="pxml_catalog_publicId_2"></a><a href="#pxml_catalog_publicId"><img src="images/callouts/1.png" alt="1" border="0"></a> </p></td><td valign="top" align="left"><p>The public ID of the DTD is <code class="literal">"-//W3C//DTD XHTML 1.0 Transitional//EN"</code>.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a name="pxml_catalog_uri_2"></a><a href="#pxml_catalog_uri"><img src="images/callouts/2.png" alt="2" border="0"></a> </p></td><td valign="top" align="left"><p>The local copy is found in <code class="uri">"xhtml1-transitional.dtd"</code> (a relative URI is relative to the URI of the XML catalog file).</p></td></tr></table></div><p>Of course, Qizx is XML Catalog-enabled. It is bundled with <code class="filename">resolver.jar</code>, the XML catalog resolver of the <a class="ulink" href="http://xml.apache.org/commons/components/resolver/index.html" target="_top">Apache XML Commons</a> project. Therefore suffice to specify one or more XML catalogs and to let the XML catalog resolver know about them. Advanced issues are well explained in <a class="ulink" href="http://xml.apache.org/commons/components/resolver/resolver-article.html" target="_top">the article "<em class="citetitle">XML Entity and URI Resolvers</em>" by Norman Walsh</a>.</p></div><h4><a name="d0e1014"></a>Using XML Catalogs</h4><p>The sample data also contains some XHTML files which refer to a DTD. If we import them in the same way (first, set the filter to "<code class="literal">*.xhtml</code>"), we notice that it takes a significant time (several seconds) while the total size is only a few hundreds kilobytes (alternately there might be a parse error if you have no access to the network). As explained in the <a class="link" href="getting_started.html#using_xml_catalogs" title="XML catalogs">"XML catalogs" sidebar</a>, this is because the DTD public identifier refers to an HTTP location, so the DTD is downloaded from the network.</p><p>To avoid this, a suitable catalog can be found in the sample data: <a class="ulink" href="../samples/xhtml_dtd/catalog.xml" target="_top"><code class="filename">docs/samples/xhtml_dtd/catalog.xml</code></a>. There are two possibilities for enabling the catalog:</p><div class="itemizedlist"><ul type="disc"><li><p>Define an environment variable <code class="envar">XML_CATALOG_FILES</code>, whose value is a list of paths (or URLs) of catalogs, separated by semicolons. This method works in any context (Qizx Studio, qizx, or application).</p></li><li><p>in Qizx Studio, there is a dialog to define the list of catalogs more conveniently: <span class="guisubmenu">Tools</span> &#8594; <span class="guimenuitem">XML Catalogs</span>. Attention, the environment variable has priority over this mechanism.</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1046"></a>3.2.&nbsp;Importing XML Documents using the qizx tool</h3></div></div></div><p>If you use this command:</p><pre class="programlisting">qizx -g c:\work\xdb1 -l scifi -include .xml -include .xhtml <a class="co" name="qizx_import_inc" href="getting_started.html#qizx_import_inc_id"><img src="images/callouts/1.png" alt="1" border="0"></a> \
    -import / docs\samples\book_data <a class="co" name="qizx_import_imp" href="getting_started.html#qizx_import_imp_id"><img src="images/callouts/2.png" alt="2" border="0"></a></pre><p>all files ending with <code class="literal">.xml</code> will be imported from directory <code class="filename">docs\samples</code>, in the same way as in Qizx Studio.</p><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a name="qizx_import_inc_id"></a><a href="#qizx_import_inc"><img src="images/callouts/1.png" alt="1" border="0"></a> </p></td><td valign="top" align="left"><p>The option <code class="option">-include</code> followed by an extension acts as a file filter. It is somewhat equivalent to the filters in Qizx Studio. It is possible to have several <code class="option">-include</code> options in a row. There is also a converse <code class="option">-exclude</code> option.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a name="qizx_import_imp_id"></a><a href="#qizx_import_imp"><img src="images/callouts/2.png" alt="2" border="0"></a> </p></td><td valign="top" align="left"><p>The option <code class="option">-import</code> specifies the target collection. This collection is created automatically if necessary.</p><p>The option can be followed by any number of paths of directories or XML documents, or even HTTP locations (URL).</p></td></tr></table></div><h4><a name="d0e1085"></a>Using XML Catalogs</h4><p>Using the qizx tool, a catalog file can be defined with the environment variable <code class="envar">XML_CATALOG_FILES</code>, as explained above.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="plesson_export"></a>4.&nbsp;Exporting Documents from an XML Library</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1095"></a>4.1.&nbsp;Using Qizx Studio</h3></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Exporting a document: using the the XML Library browser, select the document. Then right-clicking the document icon, or using the button in the document view ("<span class="guilabel">Contents of Document</span>", down right), brings an export dialog:</p><div class="figure"><a name="d0e1105"></a><p class="title"><b>Figure&nbsp;4.4.&nbsp;Exporting a Document from an XML Library</b></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="602"><tr><td><img src="resources/exporting.png" width="602" alt="Exporting a Document from an XML Library"></td></tr></table></div></div></div></div><br class="figure-break"><p>From the dialog, you can choose several export, or serialization, options:</p><div class="itemizedlist"><ul type="circle"><li><p>Encoding</p></li><li><p>Method: XML (standard), HTML or XHTML (meaningful only if the document contents are HTML), and Text (all tags are stripped, may be useful to generate code or data using the XML Query language).</p></li><li><p>Omit XML Declaration: strips the <code class="literal">&lt;?xml</code> header.</p></li><li><p>Indentation: makes the output prettier by adding whitespace.</p></li><li><p>Note that not all standard serialization options are available, only the most common ones. The command-line tool allows for all options implemented by Qizx.</p></li></ul></div></li><li><p>Exporting a whole Collection is not available currently in Qizx Studio, but it is in the qizx tool.</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1136"></a>4.2.&nbsp;Using the qizx command-line tool</h3></div></div></div><p>There are two option switches to control export of documents and collections:</p><div class="itemizedlist"><ul type="disc"><li><p>Option <code class="option">-out</code><em class="replaceable"><code> file</code></em> defines the export destination: it is a plain file if a Document is exported, it should be a directory if a Collection is exported. If it exists, it is overwritten, else it is created.</p><p>This option must come <span class="emphasis"><em>before</em></span> the <code class="option">-export</code> option.</p></li><li><p>Option <code class="option">-export</code> <em class="replaceable"><code>member</code></em> selects a Document or Collection to export.</p><p>This option should come after <code class="option">-out</code> and serialization options.</p></li><li><p><span class="bold"><strong>Serialization options</strong></span> are introduced by the switch <code class="option">-X</code> immediately followed by an option name, then if applicable the value after a '<code class="literal">=</code>' sign. Example: <code class="literal">-Xmethod=XHTML -Xencoding=UTF-8</code> .</p><p>Serialization options are described in detail <a class="link" href="general_extensions.html#serial_options_table" title="Table&nbsp;12.1.&nbsp;Implemented serialization options">here</a>.</p></li></ul></div><p>Example:</p><pre class="programlisting">qizx -g c:\work\xdb1 -l scifi -out myexporteddata -Xmethod=Html \
    -export "/sample/book_data/Authors Blurbs"</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="plesson_query"></a>5.&nbsp;Querying a Library</h2></div></div></div><p>In this section we are going to run queries on the database we have just created.</p><p>This section assume you have at least a basic knowledge of the XML Query language.</p><p>Note that the directory <a class="ulink" href="../samples/book_queries/" target="_top"><code class="filename">docs/samples/book_queries/</code></a> contains the queries needed to illustrate this lesson.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1208"></a>5.1.&nbsp;Writing and running queries with Qizx Studio</h3></div></div></div><p>Qizx Studio currently provides a basic environment for editing and running XML Query queries. Later releases will likely offer debugging facilities.</p><div class="itemizedlist"><ul type="disc"><li><p>Let us try this query (which is the contents of the file <code class="filename">docs/samples/book_queries/4.xq</code>):</p><pre class="programlisting"><span class="emphasis"><em>(: Find all books written by French authors. :)</em></span>
declare namespace t = "http://www.qizx.com/namespace/Tutorial";

for $a in collection("/Authors")//t:author[@nationality = "France"]
    for $b in collection("/Books")//t:book[.//t:author = $a/t:fullName]
    return 
        $b/t:title</pre></li><li><p>In Qizx Studio, switch to the <span class="guilabel">XQuery</span> tab, then use the menu <span class="guimenu">File</span> &#8594; <span class="guimenuitem">Open XQuery</span> to load the file mentioned above.</p><p>Note that you can also save to a file a query that you have entered or edited in Qizx Studio.</p><p>There is an history that allows running again former queries, so it is not necessary to save intermediary experiments.</p></li><li><p>Then, if you have created the XML Library as indicated in the previous sections, you can use the button Execute to run the query. After execution, we should obtain something similar to this:</p><div class="figure"><a name="d0e1243"></a><p class="title"><b>Figure&nbsp;4.5.&nbsp;Result of a query</b></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="620"><tr><td><img src="resources/query1.png" width="620" alt="Result of a query"></td></tr></table></div></div></div></div><br class="figure-break"></li><li><p>Notice that in the picture above the display mode of the right-side view has been changed to "<span class="guilabel">Data Model</span>", using the <span class="guilabel">View</span> combo-box. This makes it easier to see the Data Model structure.</p><p>The result sequence contains one item, which is a element <code class="sgmltag-element">t:title</code> whose string value is "<code class="literal">Planet of the Apes</code>".</p><p>We can for example change the value "<code class="literal">France</code>" to "<code class="literal">US</code>" in the query, and get a sequence of 8 items.</p><p>In the same location, there are a few other queries that you can also try.</p></li><li><p>The result items in the right-side view can be exported into a file using a button in the header. Notice that the resulting file will not in general be a well-formed XML document.</p></li><li><p><span class="guilabel">Diagnostic view</span>, the view at bottom left contains messages, which can be simple information (execution times) or possible execution errors.</p><p>Compilation and execution errors have generally a link to the location in the source code. By clicking the link, the location of the error is displayed in the editor view.</p></li><li><p>For more information about the editor and the query history, please see the <a class="link" href="qizxstudio.html" title="Qizx Studio Help">documentation of Qizx Studio</a>.</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1293"></a>5.2.&nbsp;Running queries with the qizx command line tool</h3></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>To run queries on a particular Library, it is sufficient to specify a XQuery source file on the command-line:</p><pre class="programlisting">qizx -g c:\work\xdb1 -l scifi 4.xq -out results.xml</pre><p>Of course, like before, we specify the Library with <code class="option">-g</code> and <code class="option">-l</code> (or <code class="option">-group</code> and <code class="option">-library</code>) switches.</p></li><li><p>Results are displayed on the console (or standard output). Retrieving results into a file works like export, by using <code class="option">-out</code> and serialization options.</p></li></ul></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="plesson_delete"></a>6.&nbsp;Copying, Renaming, Deleting Documents and Collections</h2></div></div></div><p>In this short section, we will see how to perform the basic tasks of copying, renaming and deleting Documents and Collections.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1327"></a>6.1.&nbsp;Using Qizx Studio</h3></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>In Qizx Studio, these tasks are fairly easy to perform: just right-click on the library member to copy, rename or delete, and select the proper menu item.</p></li><li><p>For copy and rename, you are prompted for a destination path: this path should be inside an existing collection, and should not point to an existing object.</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1337"></a>6.2.&nbsp;Using the qizx command-line tool</h3></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>The <code class="option">-delete</code> option switch can be used to delete any Library member given its path (Collection or Document):</p><pre class="programlisting">qizx -g c:\work\xdb1 -l scifi -delete /Authors</pre></li><li><p>There are no option switches for renaming and copying. You can resort to a script (let us put it in a file named <code class="filename">rename.xq</code>):</p><pre class="programlisting">declare variable $src-member external;
declare variable $dst-member external;
try {
  xlib:rename-member($src-member, $dst-member),
  xlib:commit()
}
catch($err) {
 element error { $err }
}</pre><div class="caution" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Caution</h3><p>It is highly recommended to wrap the operation within a <em class="replaceable"><code>try-catch</code></em>, because the functions xlib:rename-member() and xlib:commit() have side effects. The <em class="replaceable"><code>try-catch</code></em> extension guarantees that its body (the try clause) is evaluated only once and in the order specified.</p></div><p>It is highly recommended to wrap the operation within a try/catch, because otherwise the execution would be performed <span class="emphasis"><em>twice</em></span> (for the sake of display) and an error would happen (the second rename cannot work).</p><p>To run the script, use the <code class="option">-D</code> option switch to bind a value with the variables <code class="varname">$src-member</code> and <code class="varname">$dst-member</code>:</p><pre class="programlisting">qizx -g c:\work\xdb1 -l scifi rename.xq -Dsrc-member=/Authors/iasimov.xml \
    -Ddst-member=/Authors/IsaacAsimov.xml </pre><p>Of course, the copy operation can be performed in the same way using the extension function <code class="function">xlib:copy-member</code>.</p></li></ul></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e1389"></a>7.&nbsp;Updating XML Documents</h2></div></div></div><p>As of version 2.1, Qizx supports the XQuery Update extension. This extension is a powerful mechanism well integrated with the base XQuery language thats allows modifications at Node level.</p><p>To understand the basics of XQuery Update, we recommend reading our tutorial "<a class="ulink" href="http://www.xmlmind.com/_tutorials/XQueryUpdate/index.html" target="_top">XQuery Update for the impatient</a>".</p><p>Using XQuery Update in Qizx is straightforward: since XQuery Update is an extension of XQuery, executing an updating script is the same as running any other query. This is very much like in SQL, using a <code class="code">SELECT ... UPDATE</code> instruction instead of a simple <code class="code">SELECT</code>.</p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>Qizx is designed for performing fast <span class="emphasis"><em>queries</em></span>, not fast updates. Its design has deliberately sacrificed the capability to perform fast local updates inside large documents, in order to achieve greater querying speed. So we advise against updating documents larger than about one megabyte. Small documents can be updated as quickly as in any other XML database.</p></div><div class="example"><a name="d0e1413"></a><p class="title"><b>Example&nbsp;4.1.&nbsp;Delete a Node</b></p><div class="example-contents"><p>Still using the same example data as before, let us suppose we want to remove the third pseudonym of the author Jack Vance:</p><pre class="programlisting">declare namespace t = "http://www.qizx.com/namespace/Tutorial";

let $a := collection("/Authors")//t:author[t:fullName = "Jack Vance"]
return delete node $a//t:pseudonym[3]</pre><p>This returns an empty sequence, because updating expressions like <code class="code">delete node, insert node</code> etc always return an empty sequence.</p><p>In Qizx Studio, a commit is performed automatically, so we only have to check the document <code class="filename">/Authors/jvance.xml</code> to see the result. It should now contain 4 pseudonyms instead of 5, the element <code class="literal">&lt;pseudonym&gt;Peter Held&lt;/pseudonym&gt;</code> should have disappeared.</p></div></div><br class="example-break"><div class="example"><a name="d0e1433"></a><p class="title"><b>Example&nbsp;4.2.&nbsp;insert the Spanish edition of "Planet of the Apes".</b></p><div class="example-contents"><pre class="programlisting">declare default element namespace "http://www.qizx.com/namespace/Tutorial";

let $book := collection("/Books")//book[title ="Planet of the Apes"]
let $e := &lt;edition&gt;
   &lt;ISBN&gt;9788466303736&lt;/ISBN&gt;
   &lt;publisher&gt;Suma de Letras&lt;/publisher&gt;
   &lt;language&gt;Castellano&lt;/language&gt;
   &lt;year&gt;2001&lt;/year&gt;
 &lt;/edition&gt; 
return insert node $e into $book/editions</pre><p>Notice that here we use "declare default element namespace" so that the inserted nodes <code class="literal">&lt;edition&gt;...</code> have the proper namespace.</p></div></div><br class="example-break"></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="plesson_addmeta"></a>8.&nbsp;Using Metadata Properties</h2></div></div></div><p>In this lesson, we will see what are Properties and how they can be useful.</p><p><code class="interfacename">Collection</code>s and <code class="interfacename">Document</code>s can hold any number of named <em class="firstterm">properties</em>. Some properties are created automatically by the database engine (we call them <em class="glossterm">system properties</em>), but it is also possible to add properties at will (<em class="glossterm">user properties</em>).</p><p>An important aspect is that <span class="emphasis"><em>Properties can be queried</em></span>: it is possible to run a special type of queries that return a sequence of documents or collections whose properties match the query. This is a very powerful mechanism as we will see below.</p><p>A property has a name (a simple name without namespace) and a value. The possible types of a property value are:</p><div class="itemizedlist"><ul type="disc"><li><p>Boolean.</p></li><li><p>Long integer (corresponds to XQuery type <code class="literal">xs:integer</code>).</p></li><li><p>Double.</p></li><li><p>String.</p></li><li><p>java.util.Date, a date/time with millisecond precision.</p></li><li><p>Node, a single node of the XQuery data model, likely an element. This allows a property to contain rich structured information. Furthermore this XML value can be queried much in the same way as normal document content.</p></li><li><p>Any serializable Java object: this can be used through the Java API, but also in XQuery through the <a class="link" href="java_binding.html" title="Chapter&nbsp;17.&nbsp;Java&#8482; Binding">Java Binding mechanism</a>, which allows handling arbitrary Java objects in XQuery.</p></li></ul></div><p>Two system properties common to Collections and Documents are:</p><div class="variablelist"><dl><dt><span class="term">nature</span></dt><dd><p>The nature of the Library member: "<code class="literal">collection</code>" or "<code class="literal">document</code>".</p></dd><dt><span class="term">path</span></dt><dd><p>The absolute path of the Library member. Example: "<code class="literal">/Author&nbsp;Blurbs/Philip_Jose_Farmer.xhtml</code>".</p></dd></dl></div><p>Properties are sometimes called <em class="firstterm">metadata</em>: this means properties <span class="emphasis"><em>can</em></span> be used as metadata, that is, data describing data. For example, when specified, the public and system ids of the DTD of the document are stored as system properties. For documents, some statistics are computed automatically and added as properties. The source path or URI of a document and the date of import are also stored as properties.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Predefined properties are described in <a class="link" href="library_extensions.html#predef_props" title="1.&nbsp;Predefined properties">reference documentation</a>.</p></div><p>So Properties can be used as user-defined metadata: they provide an easy way to associate information with documents without altering the contents of the documents.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1540"></a>8.1.&nbsp;Properties in Qizx Studio</h3></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Let's select a document in the Library, say <code class="literal">/Authors/iasimov.xml</code>.</p></li><li><p>In the view <span class="guilabel">Metadata Properties</span>, you should see a list of properties of the document.</p></li><li><p>By right-clicking on one of the properties, and choosing "<span class="guimenuitem">Add Property</span>", a dialog should appear:</p><div class="figure"><a name="d0e1562"></a><p class="title"><b>Figure&nbsp;4.6.&nbsp;Adding a new property '<code class="literal">meta-info-1</code>'</b></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="620"><tr><td><img src="resources/metaedit.png" width="620" alt="Adding a new property 'meta-info-1'"></td></tr></table></div></div></div></div><br class="figure-break"></li><li><p>Thanks to this dialog, you can enter the name of a new property (here <code class="literal">meta-info-1</code>), choose its type (here <code class="literal">Node</code>), and enter a fragment of XML as a value.</p></li><li><p>After clicking <span class="guibutton">OK</span>, the property should be visible in the property view.</p></li></ul></div><h4><a name="d0e1587"></a>Using properties in a query</h4><p>Suppose you want to find all documents which have a <code class="literal">meta-info-1</code> property: go to the XQuery tab and enter this expression in the query editor, then run it.</p><pre class="programlisting">xlib:query-properties("/Authors", nature="document" and meta-info-1)</pre><p>You should obtain one item which is <code class="literal">document("/Authors/iasimov.xml")</code>.</p><p>Remarks:</p><div class="itemizedlist"><ul type="disc"><li><p><code class="function">xlib:query-properties</code> is an extension function which returns a list of those library members which are contained within the collection passed as first argument, and match the boolean expression passed as second argument.</p></li><li><p>The boolean expression as second argument is standard XQuery, where properties are used as if they were XML elements.</p><p>Thus <code class="literal">nature="document"</code> should be read as <span class="emphasis"><em>a library member whose property '<code class="classname">nature</code>' is equal to '<code class="literal">document</code>'</em></span>, while <code class="literal">meta-info-1</code> should be read as <span class="emphasis"><em>a member which has a property named <code class="literal">meta-info-1</code></em></span>.</p><p>It is even possible to do a full-text search on a property: for example use <code class="code">meta-info-1[ft:contains('field1')]</code> or equivalently: <code class="code">ft:contains('field1',&nbsp;meta-info-1)</code>.</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1642"></a>8.2.&nbsp;Properties in the qizx command-line tool</h3></div></div></div><p>There are no option switches to handle metadata properties in qizx. You have to resort to XQuery scripts using the extension functions described in the next section.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1647"></a>8.3.&nbsp;Extension functions for Property handling</h3></div></div></div><p>In addition to <code class="function">xlib:query-properties</code>, there are several functions in the <code class="literal">xlib:</code> namespace to handle properties: see their description in <a class="xref" href="library_extensions.html" title="Chapter&nbsp;14.&nbsp;XML Library extension functions">Chapter&nbsp;14, <i>XML Library extension functions</i></a>.</p><p>In these functions, the <em class="parameter"><code>$member</code></em> parameter can be either a path (String) or a wrapped LibraryMember object obtained for example through the functions xlib:collection() or xlib:document(). .</p><div class="variablelist"><dl><dt><span class="term"><code class="function">xlib:property-names (<em class="parameter"><code>$member</code></em>)</code></span></dt><dd><p>return a list of the names of properties owned by the object</p></dd><dt><span class="term"><code class="function">xlib:get-property ($member, $name)</code></span></dt><dd><p>returns the value of the property.</p></dd><dt><span class="term"><code class="function">xlib:set-property ($member, $name, $value)</code></span></dt><dd><p>Sets the value, creates the property if necessary. If the value is empty sequence, removes the property.</p><p>A call to this function should be committed with the function <code class="function">xlib:commit</code>.</p></dd></dl></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1695"></a>8.4.&nbsp;Using property queries to restrict the search domain of a standard query</h3></div></div></div><p>Suppose you want to perform a XQuery query, but only in those documents which are marked with a boolean property <code class="literal">latest-version</code> equal to <code class="literal">true</code> (this would be a primitive way of doing versioning).</p><p>Let us assume the query to perform is <code class="code">//section[ft:contains('prevention&nbsp;AND&nbsp;hazard')]</code> (find a section containing the word hazard and the word prevention).</p><p>Then you can write a query like this:</p><pre class="programlisting">xlib:query-properties("/", latest-version=true())//section[ft:contains('prevention AND hazard')]</pre><p>Remarks:</p><div class="itemizedlist"><ul type="disc"><li><p>The expression above is treated in a slightly special way by Qizx: normally the root of a Path Expression is a sequence of nodes, while here it is a sequence of library members. But Qizx performs an automatic expansion into a set of document nodes.</p></li><li><p>This mechanism is a powerful way to define a search domain for a query, according to criteria of arbitrary complexity. We will see in the next section a possible use of this capability.</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1724"></a>8.5.&nbsp;Custom indexes</h3></div></div></div><p>An application of the technique presented in the previous section is the management of custom indexes.</p><p>An example: suppose you have documents which contain invoices. You would like to find the invoices where the average item price is greater than a certain value. Let's suppose the average price is computed as follows:</p><pre class="programlisting">declare function local:average-item-price($invoice) {
  sum(for $item in $invoice/item return $item/price * $item/quantity)
     div sum($invoice/item/quantity)
}</pre><p>There are several possibilities:</p><div class="orderedlist"><ol type="1"><li><p>Perform directly the query using this function:</p><pre class="programlisting">collection("/invoices")/invoice[ local:average-item-price(.) &gt;= 1000 ]</pre><p>This can be very slow if there are many items.</p></li><li><p>Store the average price inside the document: this is not satisfactory, we do not want to pollute our data just for the sake of queries.</p></li><li><p>The finest solution is to use a user property named for example <code class="literal">average-item-price</code> which contains this value. The property is initialized when the document is created or updated. Then the query can be written like as follows, and should be quite fast:</p><pre class="programlisting">xlib:query-properties("/invoices", average-item-price &gt;= 1000)/invoice</pre></li></ol></div><p>Generally speaking, a custom index is simply a property containing a value that is expensive to compute. This value is initialized once when creating or updating the document. Then it can be used to perform fast queries.</p></div></div><div class="footnotes"><br><hr width="100" align="left"><div class="footnote"><p><sup>[<a name="ftn.d0e658" href="#d0e658" class="para">1</a>] </sup>This is a more advanced topic, not yet fully documented.</p></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="admin_guide.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="admin_guide.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="server.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Part&nbsp;II.&nbsp;User's Guide&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;Chapter&nbsp;5.&nbsp;Installing and Using Qizx Server</td></tr></table></div></body></html>