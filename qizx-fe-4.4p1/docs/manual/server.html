<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Chapter&nbsp;5.&nbsp;Installing and Using Qizx Server</title><link rel="stylesheet" href="html.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.73.1"><link rel="start" href="index.html" title="Qizx Manual"><link rel="up" href="admin_guide.html" title="Part&nbsp;II.&nbsp;User's Guide"><link rel="prev" href="getting_started.html" title="Chapter&nbsp;4.&nbsp;Getting started"><link rel="next" href="ch06.html" title="Chapter&nbsp;6.&nbsp;Support of standard XQuery Update"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter&nbsp;5.&nbsp;Installing and Using Qizx Server</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="getting_started.html">Prev</a>&nbsp;</td><th width="60%" align="center">Part&nbsp;II.&nbsp;User's Guide</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="ch06.html">Next</a></td></tr></table><hr></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="server"></a>Chapter&nbsp;5.&nbsp;Installing and Using Qizx Server</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="server.html#d0e1759">1. Architecture</a></span></dt><dd><dl><dt><span class="section"><a href="server.html#d0e1844">1.1. Protocol</a></span></dt><dt><span class="section"><a href="server.html#d0e1863">1.2. Server-side Implementation</a></span></dt><dt><span class="section"><a href="server.html#d0e1870">1.3. Client-side Implementation</a></span></dt></dl></dd><dt><span class="section"><a href="server.html#d0e1891">2. Installation</a></span></dt><dd><dl><dt><span class="section"><a href="server.html#d0e1905">2.1. Requirements</a></span></dt><dt><span class="section"><a href="server.html#d0e1912">2.2. Deployment of the standalone server with a configuration wizard</a></span></dt><dt><span class="section"><a href="server.html#d0e2005">2.3. Manual Installation Procedure</a></span></dt><dd><dl><dt><span class="section"><a href="server.html#d0e2336">2.3.1. Troubleshooting</a></span></dt></dl></dd><dt><span class="section"><a href="server.html#d0e2360">2.4. Testing the server</a></span></dt><dt><span class="section"><a href="server.html#d0e2416">2.5. What to do next</a></span></dt></dl></dd><dt><span class="section"><a href="server.html#acl_doc">3. Access Control</a></span></dt><dd><dl><dt><span class="section"><a href="server.html#d0e2495">3.1. How ACL work in Qizx Server</a></span></dt><dt><span class="section"><a href="server.html#d0e2725">3.2. Setting ACL in Qizx Server</a></span></dt></dl></dd><dt><span class="section"><a href="server.html#d0e2757">4. Developer Documentation</a></span></dt><dd><dl><dt><span class="section"><a href="server.html#api_service">4.1. API service</a></span></dt><dt><span class="section"><a href="server.html#xqs">4.2. XQuery services</a></span></dt><dd><dl><dt><span class="section"><a href="server.html#d0e2797">4.2.1. Protocol</a></span></dt><dt><span class="section"><a href="server.html#d0e2831">4.2.2. Creating services</a></span></dt><dt><span class="section"><a href="server.html#d0e2862">4.2.3. Description of available services</a></span></dt><dt><span class="section"><a href="server.html#bind_params">4.2.4. Parameters</a></span></dt><dt><span class="section"><a href="server.html#d0e2943">4.2.5. Result type and output options</a></span></dt><dt><span class="section"><a href="server.html#d0e2987">4.2.6. Documentation of services</a></span></dt></dl></dd><dt><span class="section"><a href="server.html#xqsp">4.3. XQuery webApps</a></span></dt><dd><dl><dt><span class="section"><a href="server.html#d0e3038">4.3.1. Creating an XQuery webApp</a></span></dt><dt><span class="section"><a href="server.html#bind_http_params">4.3.2. Parameters</a></span></dt><dt><span class="section"><a href="server.html#d0e3087">4.3.3. Result content-type and output options</a></span></dt><dt><span class="section"><a href="server.html#d0e3131">4.3.4. Function API</a></span></dt><dt><span class="section"><a href="server.html#d0e3158">4.3.5. Modules and resources</a></span></dt></dl></dd></dl></dd></dl></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e1759"></a>1.&nbsp;Architecture</h2></div></div></div><p>Qizx Server is a modular system that provides several interfaces (called <em class="glossterm">Services</em>) which can be used in different types of applications:</p><div class="figure"><a name="d0e1767"></a><p class="title"><b>Figure&nbsp;5.1.&nbsp;Qizx Server Architecture</b></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="resources/qizxarch.png" alt="Qizx Server Architecture"></div></div></div></div><br class="figure-break"><div class="orderedlist"><ol type="1"><li><a name="API_service"></a><h3><a name="d0e1776"></a>Qizx API Service</h3><p>Qizx API Service offers nearly the same services as the embeddable Qizx engine, but can be accessed by remote clients, allowing Qizx to be used as a back-end XML server.</p><p>The API Service can be used both for applications and administration:</p><div class="itemizedlist"><ul type="disc"><li><p>A client can be a web application running in a different server, using classical environments such as PHP, ASP, JSP etc.</p><p>It relates to Qizx Server by sending XQuery scripts and receiving XML fragments that can be included in their own responses. This is similar to the way many simple web applications use a Relational DBMS by sending SQL queries.</p></li><li><p>A client can be a heavy client implemented for example in Java or on top of the .NET platform.</p><p>As a particular case, the command-line tool qizx and the graphic interface QizxStudio coming with Qizx are able to use this API service. They can be used for administration tasks.</p></li></ul></div></li><li><h3><a name="d0e1794"></a>XQuery Services</h3><p>This interface provides a functionality similar to Web Services, but much simpler:</p><div class="itemizedlist"><ul type="disc"><li><p>Clients call named services, passing parameters, and retrieving results (generally as XML).</p></li><li><p>Services are implemented directly as XQuery scripts, stored on the server.</p></li><li><p>Services are self-describing: a list of possible calls and a description of each service call can be requested.</p><p>This allows generic binding on the client side, like in classical web services.</p></li><li><p>Such services can also seamlessly respond to <a class="ulink" href="http://www.w3.org/standards/techs/xforms" target="_top">XForms</a> submissions.</p></li></ul></div><p>&#9726;&nbsp;Alternately, this service can be regarded as a way of implementing middle-tier business logic on top of a XML database.</p><p>Whatever the use, this approach offers the means of encapsulating the core logic of an application, by publishing an API for the application and hiding the internals of the database. This seems a great advantage in terms of elegance and maintainability over the other solution, using the <a class="link" href="server.html#API_service">API service</a> and passing scripts.</p><p>Note that this service is somewhat experimental and likely to undergo significant changes. We are working in concert with other vendors and with consultants to progress towards a standard for such services.</p></li><li><h3><a name="d0e1826"></a>XQuery webApps (aka XQuery Server Pages)</h3><p>This service allows implementing Web Applications using XQuery as a dynamic page template language. It is available starting from version 4.3.</p><p>XQuery webApps is a service similar to web application environments such as JSP, ASP, PHP etc.</p></li><li><h3><a name="d0e1833"></a>Delayed indexing service</h3><p><span class="emphasis"><em>Not yet available in 4.3, planned in a future version of Qizx. </em></span></p><p>This service can be used when a feed of information provides a continuous flow of XML documents, and it is not critical that incoming XML data be immediately visible to applications. Example: logging of transactions, mails etc.</p><p>The service indexes incoming documents at regular intervals (for example one minute) and ensures data safety through journaling.</p><p>The purpose of this service is to help developments by a greater simplicity, safety and efficacy of such an operation.</p></li></ol></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1844"></a>1.1.&nbsp;Protocol</h3></div></div></div><p>All these services are based on HTTP, with simple REST-style interfaces using only GET and POST.</p><p>There are good reasons for not using a proprietary protocol:</p><div class="itemizedlist"><ul type="disc"><li><p>Applications can be implemented in any language or platform that supports client HTTP requests: Java, .NET, PHP etc.</p><p>Using only GET and POST is required because many HTTP client libraries have limited HTTP support.</p></li><li><p>In many companies, security constraints (firewalls and proxies) make it difficult to use anything but HTTP and GET/POST.</p></li><li><p>HTTP protocols are well known, simple to understand and can be tested through web browsers.</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1863"></a>1.2.&nbsp;Server-side Implementation</h3></div></div></div><p>All these services are implemented as Java Servlets. Thus a server can be hosted by any web application server that supports servlets.</p><p>Services can coexist inside a Servlet Container or a Web Application. Any combination of services is possible through simple configuration.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1870"></a>1.3.&nbsp;Client-side Implementation</h3></div></div></div><p>It is important to note that Qizx Server does not attempt to provide client-side libraries, except a Java client layer for the API Service, used internally for QizxStudio, QizxAdmin, command-line tool. This layer is Java documented and its source code is available: see package <span class="package">com.qizx.apps.restapi</span>&nbsp;.</p><p>The rationale is the following:</p><div class="itemizedlist"><ul type="disc"><li><p>there is a large variety of potential clients: it is simply no possible to provide a client layer for all existing environments. We also do not want to impose particular third-party software implementing such client layers.</p></li><li><p>the protocols used in Qizx Server are simple enough to be easily implemented with the generic client libraries available in many platforms like PHP, .NET.</p></li></ul></div><p>Client libraries are however planned for a next version for at least the .NET platform and for PHP.</p><p>Automatic binding to XQuery Services on these platforms is also a planned feature.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e1891"></a>2.&nbsp;Installation</h2></div></div></div><p>In the current version, Qizx Server is a Web Application hosted by any J2EE Servlet Container.</p><p>The installation can be achieved in two different ways:</p><div class="itemizedlist"><ul type="disc"><li><p>Standalone server configured with a wizard-style tool. This should allow to deploy Qizx Server in a few clicks.</p></li><li><p>Manual installation using standard Java Servlet techniques.</p></li></ul></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1905"></a>2.1.&nbsp;Requirements</h3></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Java runtime environment version 5+ (version 6 recommended).</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1912"></a>2.2.&nbsp;Deployment of the standalone server with a configuration wizard</h3></div></div></div><p>From version 4.1, a wizard-style tool allows running Qizx Server inside a bundled server (Jetty 7):</p><div class="itemizedlist"><ul type="disc"><li><p>Installation and configuration are very easy thanks to the tool. This tool can also work in console mode.</p><p>With this tool, you can configure the location of the Qizx server configuration (including XML databases), the protocol (http or https), the http port, the authentication mode (basic or digest), the users.</p></li><li><p>The tool is also used for starting and stopping the server.</p></li><li><p>The server can be reconfigured as easily using the same tool.</p></li></ul></div><h4><a name="d0e1929"></a>Procedure:</h4><div class="orderedlist"><ol type="1"><li><p>Run the wizard tool:</p><p>On Windows, double click on <span class="emphasis"><em>QIZX_DISTRIB</em></span>/server/standalone/bin/qizxserver.bat&nbsp;.</p><pre class="programlisting">Unix&gt; <span class="emphasis"><em>QIZX_DISTRIB</em></span>/server/standalone/bin/qizxserver</pre><p>You should see this window appear:</p><div class="screenshot"><div class="mediaobject"><img src="resources/mainWindow.png"></div></div></li><li><p>In console mode on Windows or Unix, use the -c option:</p><pre class="programlisting">Windows&gt; <span class="emphasis"><em>QIZX_DISTRIB</em></span>\server\standalone\bin\qizxserver.bat -c</pre><pre class="programlisting">Unix&gt; <span class="emphasis"><em>QIZX_DISTRIB</em></span>/server/standalone/bin/qizxserver -c</pre></li><li><p>Click on the <span class="guiicon">Configure</span> icon, and fill the fields.</p><p>Use the <span class="guiicon">Help</span> button (bottom left) for more instructions about about each configuration step.</p></li><li><p><span class="bold"><strong>The first step is to choose the server storage directory</strong></span>: decide the place where you want your server data to reside. This directory contains configuration files and data files. It is deliberately not contained inside the Web Application to ensure that data will not be lost accidentally.</p><p>Make sure you have enough free disk space (e.g. several gigabytes) to handle the amount of data that will be stored there. A Qizx Library with all indexes is roughly the size of the source XML it contains, but indexing or reindexing uses temporary files that can reach up to 2 times this size.</p></li><li><p>When configuring is finished, start the server with the <span class="guiicon">Start</span> icon:</p><p>the tool indicates the URL to use in your browser (click on 'Copy' to copy the link in the clipboard).</p><div class="screenshot"><div class="mediaobject"><img src="resources/startedInfo.png"></div></div></li><li><p>Once the server is started, it is possible to quit the wizard tool. The server will keep running. To stop it, rerun the tool and click on <span class="guiicon">Stop</span>.</p></li></ol></div><p></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e2005"></a>2.3.&nbsp;Manual Installation Procedure</h3></div></div></div><p>This installation procedure should be suitable for any compliant Servlet Container.</p><p>By following the following procedure step by step, a member of your IT staff should be able to easily deploy Qizx Server on a Servlet container. This procedure involves:</p><div class="orderedlist"><ol type="1"><li><p>Creating the storage directory of the server: this is kept separate from the Servlet container to avoid accidentally destroying precious data.</p><p>This directory contains the configuration, the XML database(s) (called Library) and optionally XQuery modules and stored XQuery scripts.</p></li><li><p>Completing and deploying the Qizx Server WebApp on your Servlet Container,</p></li><li><p>Specifying how user authentication is to be performed, and making sure at least one user has administrator privilege.</p><p>User authentication can depend on your Servlet Container and on the desired type of authentication.</p></li></ol></div><h4><a name="d0e2026"></a>Requirements:</h4><div class="itemizedlist"><ul type="disc"><li><p>Java runtime environment version 5+ (version 6 recommended).</p></li><li><p>A Servlet Container that supports at least Servlets version 2.4, for example Apache Tomcat 5.5.</p><p>Note: to date the server has been tested with Tomcat 5.5 and 6, Jetty 7, and Caucho Resin 3.1.</p></li></ul></div><p>The installation uses commands in a terminal window:</p><div class="orderedlist"><ol type="1"><li><p><span class="bold"><strong>Choose the server storage directory</strong></span>: decide the place where you want your server data to reside. This directory, referred to as <em class="glossterm">Qizx_Server_Root</em> all over this documentation, contains configuration files and data files. It is deliberately not contained inside the Web Application to ensure that data will not be lost accidentally.</p><p>Make sure you have enough free disk space (e.g. several gigabytes) to handle the amount of data that will be stored there. A Qizx Library with all indexes is roughly the size of the source XML it contains, but indexing or reindexing uses temporary files that can reach up to 2 times this size.</p></li><li><p><span class="bold"><strong>Copy the template server root from the Qizx distribution</strong></span>:</p><p>A model of a server root is found in QIZX_DISTRIB/server/root.</p><pre class="programlisting">Unix&gt; cp -r <span class="emphasis"><em>QIZX_DISTRIB</em></span>/server/root  <span class="emphasis"><em>Qizx_Server_Root</em></span></pre><p>On Windows, you can use the Explorer to perform the copy.</p><p>In the server storage directory <span class="emphasis"><em>Qizx_Server_Root</em></span>, you should now have the following contents:</p><div class="itemizedlist"><ul type="disc"><li><p><code class="filename">qizx-server.conf</code>&nbsp;: contains the configuration of the server. It is self-documented and allows modifying parameters like maximum memory sizes, XML catalogs, administrator credentials.</p><p>It is advisable to review this file. In particular it contains the name of administrator users or role. This is explained in section "user authentication" below.</p><p>If you modify this configuration while the Qizx engine in running, you have to restart the engine by using the "-server reload" command in <span class="command"><strong>qizx</strong></span> tool (<a class="ulink" href="qizxtool.html" target="_top">see its documentation</a>).</p></li><li><p><code class="filename">xlibraries</code>: a directory that can contain one or several databases (also called <em class="glossterm">XML Libraries</em>). For the moment it contains one empty XML Library called xlib. You can change this name if you wish.</p></li><li><p><code class="filename">modules</code>: a directory where XQuery modules can be stored.</p></li><li><p><code class="filename">xqs</code>: a directory where XQuery scripts can be stored, to implement XQuery Services.</p></li><li><p>Note that the above names: <code class="filename">xlibraries, modules</code> and <code class="filename">xqs</code> are not hard-coded: they are defined in <code class="filename">qizx-server.conf</code> and can be changed.</p></li></ul></div></li><li><p><span class="bold"><strong>Choose the name of the Web App</strong></span> in which the server will run.</p><p>The name <span class="command"><strong>qizx</strong></span> is used in this documentation, but this can be changed at will. <span class="bold"><strong>Attention</strong></span>: examples coming with Qizx Server will not work if this name is not <span class="command"><strong>qizx</strong></span>.</p><p>This name is important for determining the address (URL) that applications will use to connect to the server.</p><p>For example, if you choose <span class="command"><strong>qizx</strong></span>, and if your host name is <code class="uri">myhost</code> and the port <code class="uri">8080</code>, the URL of the Qizx server will be <code class="uri">http://myhost:8080/qizx/api</code>&nbsp;.</p><p>Technical note: in this address, <code class="computeroutput">qizx</code> is the name of the Web App, and <code class="computeroutput">api</code> is a <span class="emphasis"><em>mapping</em></span> of the API service of Qizx Server. This mapping can also be changed by editing the <code class="computeroutput">web.xml</code> configuration file of the Web App. We will get back at this later.</p></li><li><p><span class="bold"><strong>Prepare to create the Web App</strong></span>:</p><div class="orderedlist"><ol type="a"><li><p>Stop the Servlet Container.</p><p>This is not mandatory but recommended, as the new Web App will perhaps require some adjustments before running.</p></li><li><p>open a terminal and change current directory to the directory in your Servlet Container installation that contains web applications, generally called <code class="filename">webapps</code>.</p><p>For example if you have Tomcat installed in /opt/tomcat:</p><pre class="programlisting">&gt; cd /opt/tomcat/webapps</pre><p>Or if you have <a class="ulink" href="http://caucho.com/resin-4.0/" target="_top">Caucho Resin</a> installed in c:\works\resin4.0.6&nbsp;:</p><pre class="programlisting">C:\&gt; cd works\resin4.0.6\webapps</pre></li></ol></div></li><li><p><span class="bold"><strong>Actual creation</strong></span>: copy the template 'qizx' found in <code class="filename">QIZX_DISTRIB/server/qizx</code>.</p><pre class="programlisting">Unix&gt; cp -r <span class="emphasis"><em>QIZX_DISTRIB</em></span>/server/qizx qizx</pre></li><li><p>In the WebApp directory (here <code class="filename">qizx</code>), you should find the following contents:</p><div class="itemizedlist"><ul type="disc"><li><p>WEB-INF/web.xml, the webapp configuration file. It contains the definition of servlets that implement the services, and the mapping of these servlets to URLs.</p><p>The servlets have one initialization parameter which must point to <span class="emphasis"><em>Qizx_Server_Root</em></span>: <span class="emphasis"><em>you need to edit web.xml</em></span> to replace the value of the parameter (<span class="emphasis"><em>caution</em></span>: several occurrences).</p><pre class="programlisting">&lt;servlet&gt;
  &lt;description&gt;This servlet implements the REST-style API Service.&lt;/description&gt;
  &lt;servlet-name&gt;qizx-api&lt;/servlet-name&gt;
  &lt;servlet-class&gt;com.qizx.server.api.RESTAPIServlet&lt;/servlet-class&gt;
  &lt;init-param&gt;
      &lt;description&gt;Location of the Qizx Server root.&lt;/description&gt;
      &lt;param-name&gt;qizx-server-root&lt;/param-name&gt;
      &lt;param-value&gt;<span class="emphasis"><em>Qizx_Server_Root</em></span>&lt;/param-value&gt;
  &lt;/init-param&gt;</pre><p><span class="emphasis"><em>Caution</em></span>: it is recommended to use an absolute path for <span class="emphasis"><em>Qizx_Server_Root</em></span>.</p></li><li><p>index.html : points to the examples hereafter.</p></li><li><p>apidemo: a directory containing HTML files that are both a documentation and a demonstration of the API requests. Once the server will be online, you can use this demonstration to discover and understand the API.</p></li><li><p>xqsdemo: a directory containing a simple demonstration of the XQuery Services.</p></li></ul></div></li><li><p><span class="bold"><strong>User authentication</strong></span>: this step depends on your Servlet Container and on the desired type of authentication. We give examples for two containers, Tomcat and Caucho Resin.</p><div class="orderedlist"><ol type="I"><li><p>Concepts:</p><div class="orderedlist"><ol type="a"><li><p>Qizx Server has a notion of administrator privilege: operations of administration type can only be achieved by privileged user. This can be granted on user names or through a <em class="glossterm">role</em> defined in the servlet container.</p></li><li><p>A privileged user name can be specified explicitly in the configuration file <code class="filename">qizx-server.conf</code>, in the property <code class="code">admin_users</code>. By default, the name 'qizx-admin' is defined there.</p></li><li><p>A privileged role can be defined through property <code class="code">admin_role</code>.</p><p>Any user having this role has administrator privilege in Qizx Server. By default the value is 'manager'.</p></li><li><p>If both <code class="code">admin_role</code> and <code class="code">admin_users</code> are empty or undefined, then there is no restriction on privileged operations: for security this is not recommended.</p></li></ol></div></li><li><p>Examples using BASIC authentication:</p><p>In this example, both qizx-admin and john will be able to perform privileged operations on Qizx Server:</p><div class="orderedlist"><ol type="a"><li><p>With Tomcat:</p><p>Edit the file conf/tomcat-users.xml in your Tomcat installation and add:</p><pre class="programlisting">&lt;tomcat-users&gt;
  &lt;role rolename="manager"/&gt;
  &lt;user username="qizx-admin" password="changeit!" roles="manager"/&gt;
  &lt;user username="john" password="changeit!" roles="manager"/&gt;
    ...</pre></li><li><p>With Caucho Resin:</p><p>Add a file resin-web.xml into directory WEB-INF of the web app, and edit it to define user qizx-admin and add role manager to user john:</p><pre class="programlisting">&lt;resin:XmlAuthenticator password-digest="none"&gt;
    &lt;resin:user name="qizx-admin" password="changeit!" roles="manager"/&gt;
    &lt;resin:user name="john" password="changeit!" roles="manager"/&gt;
    ...</pre></li></ol></div><p>Note: these examples assume that you keep the user and role defined by default in <code class="filename"><code class="literal">Qizx_Server_Root</code>/qizx-server.conf</code>. You can also change these properties and keep your own users already defined in your servlet container.</p></li><li><p>Other types of authentication depend much on the actual servlet container.</p><p>Please note that the default WEB-INF/web.xml in Qizx web app uses BASIC authentication in the &lt;login-config&gt; item.</p></li></ol></div></li><li><p><span class="bold"><strong>The servlet container can now be restarted.</strong></span></p><p>Before restarting:</p><div class="itemizedlist"><ul type="disc"><li><p>Check that the account running the servlet container has rights for reading and writing on the <span class="emphasis"><em>Qizx_Server_Root</em></span>.</p></li><li><p>Check that firewalls, if any, are allowing HTTP connections on the desired port.</p></li></ul></div></li></ol></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e2336"></a>2.3.1.&nbsp;Troubleshooting</h4></div></div></div><p>If you cannot connect to the Qizx server either with your browser or with QizxStudio, look at the logs of your servlet container: there is likely a message indicating a cause of error.</p><div class="variablelist"><dl><dt><span class="term">"access denied"</span></dt><dd><p>You could see a message looking like:</p><pre class="programlisting">java.security.AccessControlException: access denied (java.io.FilePermission /path/to/qizxserver read)</pre><p>First check that the the process running the Servlet container actually has file access rights (read and write) to the Qizx server root.</p><p>Otherwise this can be due to the security policy of the Servlet container: the issue has been especially encountered on Ubuntu with the prepackaged Tomcat server, but it might also happen with any Servlet containers with a tight security policy.</p><p>A possible solution is to disable the security manager. Another solution is to define additional rules:</p><pre class="programlisting">grant codeBase "file:${catalina.base}/webapps/qizx/-" {
  permission java.io.FilePermission "/path/to/qizxserver", "read,write";
  permission java.io.FilePermission "/path/to/qizxserver/*", "read,write";
}</pre><p>See the documentation of your Servlet container for more details.</p></dd></dl></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e2360"></a>2.4.&nbsp;Testing the server</h3></div></div></div><div class="orderedlist"><ol type="1"><li><p>Test that Qizx Server is working by using a web browser and entering the address</p><p><code class="uri"> http://myhost:8080/qizx</code></p><p>(assuming that the server host is myhost and the server is listening on port 8080, and that you chose qizx as web app name).</p><p>You should see a page pointing the documentation/demonstrations of the server's APIs.</p><p>Before that, you will be asked a login and password by your browser: enter the name and password of an administrator user.</p><div class="figure"><a name="d0e2376"></a><p class="title"><b>Figure&nbsp;5.2.&nbsp;API demonstration and test pages</b></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="567"><tr><td><img src="resources/apidemo.png" width="567" alt="API demonstration and test pages"></td></tr></table></div></div></div></div><br class="figure-break"></li><li><p>You can also use <a class="ulink" href="qizxstudio.html" target="_top">Qizx Studio</a> or the command-line tool <a class="ulink" href="qizxtool.html" target="_top">qizx</a>.</p><p>In that case, you have to use a slightly different address:</p><p><code class="uri"> http://myhost:8080/qizx/api</code></p><p>For example:</p><pre class="programlisting">qizxstudio -g http://myhost:8080/qizx/api</pre><p>Or using the menu <span class="guimenuitem">Tools | Connect to Server</span> in Qizx Studio, enter this same address.</p><p>Note that the http: prefix is required for distinguishing a remote server from a local Library group.</p><p>You will likely be asked a login and password (unless you have deactivated user authentication in the web app configuration). You can also specify credentials on the command line (not very secure):</p><pre class="programlisting">qizxstudio -g http://myhost:8080/qizx/api -login me:mypassword</pre><p>or in a file (see documentation of tools):</p><pre class="programlisting">qizxstudio -g http://myhost:8080/qizx/api -auth credentials</pre></li></ol></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e2416"></a>2.5.&nbsp;What to do next</h3></div></div></div><p>After starting Qizx Server, you might want to:</p><div class="orderedlist"><ol type="1"><li><p><span class="bold"><strong>Create an XML Library</strong></span> (database):</p><div class="itemizedlist"><ul type="disc"><li><p>With QizxStudio, right-click on the server icon in the Library view and choose <span class="guimenuitem">Create a Library</span>.</p></li><li><p>With the demo in your web browser, click on <span class="guimenuitem">'mklib: create an XML Library'</span> on the left, and enter the name of your Library, then <span class="guimenuitem">submit request</span>.</p></li><li><p>With command-line tool qizx, type a command similar to the following one:</p><pre class="programlisting">qizx -g http://myhost:8080/qizx/api -auth credentials -library <span class="emphasis"><em>mylib</em></span> -create</pre></li></ul></div></li><li><p><span class="bold"><strong>Populate the XML Library</strong></span> with documents:</p><p>This is similar to using a local XML Library group, and explained in chapter <a class="xref" href="getting_started.html" title="Chapter&nbsp;4.&nbsp;Getting started">Chapter&nbsp;4, <i>Getting started</i></a>.</p></li><li><p><span class="bold"><strong>Define Access Control rules</strong></span>: this is useful if your applications have several classes of users, and you want to restrict the access of some users to certain parts of your database. By default all users can read, query and update all documents and collections.</p><p>See dedicated chapter <a class="xref" href="server.html#acl_doc" title="3.&nbsp;Access Control">Section&nbsp;3, &#8220;Access Control&#8221;</a>.</p></li></ol></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="acl_doc"></a>3.&nbsp;Access Control</h2></div></div></div><p><em class="glossterm">Access Control</em> is the mechanism that controls whether a User (already authenticated) may read, query or modify a Document or a Collection inside an XML Library.</p><div class="itemizedlist"><ul type="disc"><li><p>By default all users can read, query and update all documents and collections.</p></li><li><p>Restricting access is useful if an application of Qizx Server involves diverse kinds of users, some less trusted that others, and you want to prevent some users of doing some operations.</p><p>If all users are trusted, or if there is only one generic user, this feature is perhaps not useful.</p></li></ul></div><p>In Qizx, Access Control is clearly separated from user authentication and user management (which are not part of Qizx core, and delegated to the servlet container in Qizx Server).</p><div class="itemizedlist"><ul type="disc"><li><p>User names and Role names are defined externally: in Qizx Server, they are defined by the Servlet container configuration.</p></li></ul></div><p>Access Control in Qizx Server is by default based on ACL (Access Control Lists). This allows a powerful control with negligible performance impact.</p><p>It is possible to change the AccessControl implementation by plugging a different class, but that is advanced customization, unlikely to be necessary.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e2495"></a>3.1.&nbsp;How ACL work in Qizx Server</h3></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Basically, Access Control Lists are lists of elementary <span class="command"><strong>grant</strong></span> and <span class="command"><strong>deny</strong></span> entries.</p></li><li><p>Each Access Control Entry (ACE) defines</p><div class="itemizedlist"><ul type="circle"><li><p>access rights (<span class="emphasis"><em>permissions</em></span>),</p></li><li><p>for a <span class="emphasis"><em>set of users</em></span>,</p></li><li><p>on an <span class="emphasis"><em>object</em></span> (in Qizx: a Collection or a Document).</p></li></ul></div><p>For example (in informal syntax): "<span class="emphasis"><em>grant user</em></span> john <span class="emphasis"><em>permission</em></span> read,write <span class="emphasis"><em>on collection</em></span> /users/john"</p><p>or "<span class="emphasis"><em>deny</em></span> all users <span class="emphasis"><em>permission</em></span> write <span class="emphasis"><em>on collection</em></span> /system".</p></li><li><p>ACL are <span class="emphasis"><em>inherited</em></span>. This means that access rights defined on a Collection are applicable on all documents and sub-collections contained within the collection (unless they have their own rules).</p><p>This is a powerful mechanism, since a few rules (ACE) are sufficient for controlling access to an entire hierarchy of documents, without need to define rules on each and every document or collection.</p><p>Typically, with a few ACL is it possible to specify for example that:</p><div class="itemizedlist"><ul type="circle"><li><p>The whole database is read-only for users</p></li><li><p>Except specific collections /A and /B and their children which can be read and queried only by privileged users U1 and U2.</p></li><li><p>Collection /C can be modified only by certain users which have the <span class="emphasis"><em>role</em></span> 'manager'.</p></li></ul></div></li><li><p>The order of ACE is important: an ACE can be superseded by a following ACE.</p><p>Example (still in informal syntax): here the second ACE supersedes the first one, so admin has the permission to write.</p><pre class="programlisting">&nbsp;&nbsp;&nbsp;deny all users permission write on collection /system
&nbsp;&nbsp;&nbsp;grant user admin permission write on collection /system</pre></li><li><p>User names and Role names are defined externally by the Servlet container configuration.</p></li><li><p>In Qizx, ACL are defined using an XML syntax. Example:</p><pre class="programlisting">&lt;accesscontrol&gt;
  &lt;member path='/'&gt;
    &lt;deny user='*' permissions='Write'/&gt;
    &lt;grant user='*' permissions='Read'/&gt;
    &lt;grant role='manager' permissions='SetContent'/&gt;
  &lt;/member&gt;
  &lt;member path='/users/john'&gt;
    &lt;deny user='*' permissions='Read Write'/&gt;  &lt;!-- forbidden to anybody --&gt;
    &lt;grant user='john' permissions='All'/&gt;
    &lt;grant user='jane jim' permissions='Read'/&gt;  &lt;!-- allow friends to read --&gt;
  &lt;/member&gt; 
&lt;/accesscontrol&gt;</pre><div class="itemizedlist"><ul type="circle"><li><p>Root element is <code class="sgmltag-element">accesscontrol</code>.</p></li><li><p>It contains a list of <code class="sgmltag-element">member</code> elements</p></li><li><p>Each <code class="sgmltag-element">member</code> element contains a list of ACE for a particular collection (or document but this is not encouraged). The attribute <code class="sgmltag-element">path</code> must be present.</p></li><li><p>An ACE can be <code class="sgmltag-element">grant</code> or <code class="sgmltag-element">deny</code>.</p></li><li><p>It has a mandatory attribute <code class="sgmltag-element">permissions</code>. The value of this attribute is a list of permission names separated by spaces or commas. See table of permissions hereafter.</p></li><li><p>A <code class="code">grant/deny</code> must have either a <code class="sgmltag-element">user</code> attribute or a <code class="sgmltag-element">role</code> attribute.</p><div class="itemizedlist"><ul type="square"><li><p>Value of attribute <code class="sgmltag-element">user</code> can be a list of user names: e.g <code class="code">user='jane jim'</code>&nbsp;.</p></li><li><p>Value of attribute <code class="sgmltag-element">user</code> can also be '*': all users.</p></li><li><p>Value of <code class="sgmltag-element">role</code> can be a list of role names.</p></li></ul></div></li></ul></div><table frame="box" rules="all" id="d0e2661"><caption>Table&nbsp;5.1.&nbsp;Permissions</caption><thead><tr align="center"><th rowspan="1" colspan="1">Symbol</th><th rowspan="1" colspan="1">Permission</th></tr></thead><tbody><tr><td rowspan="1" colspan="1"><code class="constant">GetContent</code></td><td rowspan="1" colspan="1">Read the content of a document, list children of a collection</td></tr><tr><td rowspan="1" colspan="1"><code class="constant">SetContent</code></td><td rowspan="1" colspan="1">Replace content of a document, insert/delete/replace children of a collection.</td></tr><tr><td rowspan="1" colspan="1"><code class="constant">GetProperty</code></td><td rowspan="1" colspan="1">Read and query properties of document or collection.</td></tr><tr><td rowspan="1" colspan="1"><code class="constant">SetProperty</code></td><td rowspan="1" colspan="1">Add/modify/delete properties of document or collection.</td></tr><tr><td rowspan="1" colspan="1"><code class="constant">Content</code></td><td rowspan="1" colspan="1">short name for GetContent + SetContent</td></tr><tr><td rowspan="1" colspan="1"><code class="constant">Properties</code></td><td rowspan="1" colspan="1">short name for GetProperty + SetProperty</td></tr><tr><td rowspan="1" colspan="1"><code class="constant">Read</code></td><td rowspan="1" colspan="1">short name for GetContent + GetProperty</td></tr><tr><td rowspan="1" colspan="1"><code class="constant">Write</code></td><td rowspan="1" colspan="1">short name for SetContent + SetProperty</td></tr><tr><td rowspan="1" colspan="1"><code class="constant">All</code></td><td rowspan="1" colspan="1">short name for all permissions</td></tr></tbody></table></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e2725"></a>3.2.&nbsp;Setting ACL in Qizx Server</h3></div></div></div><p>Setting ACL in a Qizx Server is an administrator operation. It cannot be performed by ordinary users.</p><div class="variablelist"><dl><dt><span class="term">In QizxStudio</span></dt><dd><p>right-click on a collection and select "Modify Access Rights". A dialog appears and allows modifying the XML representation of access rights for the collection.</p></dd><dt><span class="term">In Qizx Server API demo</span></dt><dd><p>Use link <a class="ulink" href="???" target="_top">setacl: Set Access Rights</a> and enter the XML representation of access-rights.</p></dd><dt><span class="term">In command-line qizx</span></dt><dd><p>Prepare a file containing the ACL in XML. Use option switch <code class="code">-set-acl file</code> to upload the ACL to the server.</p></dd></dl></div><p>A more user-friendly interface should be provided in later versions.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e2757"></a>4.&nbsp;Developer Documentation</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="api_service"></a>4.1.&nbsp;API service</h3></div></div></div><p>The REST API is documented through the demo pages.</p><p>Using a web browser, enter the URL: <span class="bold"><strong>http://myhost:8080/qizx/apidemo/</strong></span></p><p>(assuming that the servlet container is on that host and port, and that you have named the webapp 'qizx', like in the examples above).</p><p>Each request is documented by a page describing it and allowing to execute it:</p><div class="itemizedlist"><ul type="disc"><li><p>Purpose of the request</p></li><li><p>Format of results</p></li><li><p>Possible errors. The format of errors is described in a dedicated page.</p></li><li><p>Arguments: each argument corresponds with a form field.</p><p>A Submit button can be used to run the request with the provided arguments and see the results.</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="xqs"></a>4.2.&nbsp;XQuery services</h3></div></div></div><p>XQuery Services is a simple mechanism allowing to call XQuery scripts stored in the server.</p><p>Such scripts need only to follow a few conventions and be placed in the appropriate location inside the server storage.</p><p>The mapping to an URL is straightforward. Request parameters are automatically bound to XQuery variables with conversion to the declared type.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e2797"></a>4.2.1.&nbsp;Protocol</h4></div></div></div><p>Like other services in Qizx Server, this service uses HTTP.</p><p>Supported request formats:</p><div class="itemizedlist"><ul type="disc"><li><p>GET with parameters in the URL</p></li><li><p>POST with form-urlencoded content type.</p></li><li><p>POST with multipart/form-data content type.</p></li></ul></div><p>Parameters are retrieved transparently and bound to XQuery variables (see <a class="link" href="server.html#bind_params" title="4.2.4.&nbsp;Parameters">Parameters</a> section).</p><p>Restrictions:</p><div class="itemizedlist"><ul type="disc"><li><p>anonymous file fields are not supported.</p></li><li><p>several parameters with same name yield undefined results.</p></li><li><p>Binary file fields (e.g images) are not supported currently.</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e2831"></a>4.2.2.&nbsp;Creating services</h4></div></div></div><div class="orderedlist"><ol type="1"><li><p>An elementary service is defined by simply depositing a XQuery script within the <span class="package">xqs</span> directory of a <em class="glossterm">Qizx_Server_Root</em>.</p><p>For example, a script named search.xqs is placed in sub-directory <code class="filename">client</code> of <code class="filename">Qizx_Server_Root/xqs</code>. It can be invoked with the following URL (still using the same example host, port, and webapp as before):</p><pre class="programlisting">http://myhost:8080/qizx/xqs/client/search.xqs</pre></li><li><p>This xqs directory can be structured in packages. By convention, a package should represent a set of related services.</p><p>For example the package <code class="filename">client</code> would contain several services on clients like search, retrieve, create, update, delete.</p></li></ol></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e2862"></a>4.2.3.&nbsp;Description of available services</h4></div></div></div><p>A description of available services in a particular package can be obtained by a GET at the URL of that package.</p><p>This will return a XML description of services available in this package.</p><p>Example:</p><pre class="programlisting">http://myhost:8080/qizx/xqs/client/</pre><p>returning:</p><pre class="programlisting">&lt;services package="/client"&gt;
  &lt;service name="create" result-type="xs:string"&gt;
    &lt;parameter name="client-name" type="xs:string"/&gt;
    &lt;output-option name="method"&gt;text&lt;/output-option&gt;
    &lt;documentation&gt;Create a new client and return the id.&lt;/documentation&gt;
  &lt;/service&gt;
  ...
&lt;/services&gt;</pre><div class="itemizedlist"><ul type="disc"><li><p>The XML description is straightforward: basically it is a list of <code class="computeroutput">service</code> elements wrapped in a top element <code class="computeroutput">services</code>.</p><p>Example:</p><pre class="programlisting">&lt;services package="/client"&gt;

  &lt;service name="create" result-type="xs:string"&gt;
    &lt;parameter name="client-name" type="xs:string"/&gt;
    &lt;output-option name="method"&gt;text&lt;/output-option&gt;
    &lt;documentation&gt;Create a new client and return an id.&lt;/documentation&gt;
  &lt;/service&gt;
  ...
&lt;/services&gt;</pre><div class="itemizedlist"><ul type="circle"><li><p>Each service has a name and type attribute (type is inferred from the expression).</p></li><li><p>Then come parameters with their name (without prefix) and type.</p></li><li><p>Then output options with name and value (as content).</p></li><li><p>Then the documentation comment if any.</p></li></ul></div></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="bind_params"></a>4.2.4.&nbsp;Parameters</h4></div></div></div><p>Parameters for each elementary request are specified through global XQuery variables:</p><pre class="programlisting">declare variable $param:client-name as xs:string external;
declare variable $param:year as xs:integer external;
...</pre><div class="orderedlist"><ol type="1"><li><p>The name of a parameter must use the predefined namespace prefix <code class="varname">param</code>.</p></li><li><p>A parameter may have a default value:</p><pre class="programlisting">declare variable $param:year as xs:integer := 2010;</pre><p>A parameter with a default value needs not be specified in the request.</p><p>An execution error happens on use of a parameter without default value and not specified in the request.</p></li><li><p>A parameter may have a type declaration. If not defined, the actual type is xs:string.</p><p>If the type is specified, the value of the parameter can be converted from the string representation to the specified type.</p><p><span class="bold"><strong>Special case</strong></span>: if type node() or element() is specified, the value is considered XML and parsed into a node. In practice, only XML types node(), element() and document-node() can be passed this way (because of parsing): attribute, comment, processing-instruction, text nodes are not supported.</p></li><li><p>If a parameter has no type:</p><p>if it is not a multipart File (i.e using GET or POST form-urlencoded), then the value is converted to String (xs:string).</p><p>Otherwise (multipart File) no conversion happens, the parameter is not bound. This is reserved for future use.</p></li></ol></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e2943"></a>4.2.5.&nbsp;Result type and output options</h4></div></div></div><p>To define the way results are formatted in the response, XQS uses XQuery options in the declaration part of each query.</p><p>Example:</p><pre class="programlisting">  declare option output:encoding "UTF-8";</pre><p>Available options:</p><p>These are the common serialization options (see section <a class="link" href="general_extensions.html#serial_func">Serialization</a><em class="wordasword">)</em>, preceded by the <span class="command"><strong>output:</strong></span> prefix. This prefix is predefined (this is actually a XQuery 1.1 feature).</p><p>Most important options are:</p><div class="orderedlist"><ol type="1"><li><p><span class="bold"><strong>method</strong></span>: standard values "XML", "XHTML", "HTML" and "TEXT".</p></li><li><p><span class="bold"><strong>encoding</strong></span>: values like "UTF-8", "ISO-8859-15".</p></li><li><p><span class="bold"><strong>content-type</strong></span>: allows fine control on the mime type of the request response (header Content-Type).</p><p>Normally this value is deduced from the output method: for example text/xml if method="XML", etc. but in some circumstances you may want to use application-specific values like <code class="computeroutput">image/svg+xml</code>.</p></li></ol></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e2987"></a>4.2.6.&nbsp;Documentation of services</h4></div></div></div><p>Each request can be documented by a special comment beginning with a tilde character:</p><p>Example:</p><pre class="programlisting">(:~
 :  Create a new client and return an id.
 :)
declare variable $param:client-name as xs:string external;
...</pre><p>Note: no particular structure is defined yet for these comments.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="xqsp"></a>4.3.&nbsp;XQuery webApps</h3></div></div></div><p>XQuery webApps is a simple mechanism using XQuery as a dynamic web page generation language.</p><p>This kind of technology is relatively new and not yet mainstream, but it makes total sense if the underlying data storage is an XML database: XML data retrieved from (or stored to) the database is directly handled by XQuery, which offers natural and powerful means to transform and format it.</p><p>In other words XQuery running on a native XML database (such as Qizx) can for example replace the well-known couple PHP-MySQL.</p><p>Page templates are simply an XQuery <em class="glossterm">constructor</em> representing a HTML/XHTML page, where dynamically computed parts of the page are XQuery expressions, that can for example directly tap into an XML database.</p><p>Note: XQSP (XQuery Server Pages) is the former name of the XQuery webApp mechanism, chosen by analogy with JSP or ASP.</p><h4><a name="d0e3014"></a>Example 1</h4><p>A very simple page, displaying the user name and the current time. The two computed expressions are in bold.</p><pre class="programlisting">&lt;html&gt;&lt;head&gt;&lt;title&gt;WebApp example 1&lt;/title&gt;&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;Hello <span class="bold"><strong>{ request:user-name() }</strong></span>!&lt;/h1&gt;
&lt;p&gt;Time is <span class="bold"><strong>{ current-date() }</strong></span>&lt;/p&gt;
&lt;/body&gt;</pre><h4><a name="d0e3026"></a>Example 2</h4><p>A more elaborated example, with a parameter representing a full-text query. This page simply displays the number of documents in a particular collection matching the query:</p><pre class="programlisting">declare variable $param:query as xs:string external;

&lt;html&gt;&lt;head&gt;&lt;title&gt;WebApp example 2&lt;/title&gt;&lt;/head&gt;
&lt;body&gt;
&lt;h3&gt;Query "<span class="bold"><strong>{ $param:query }</strong></span>":&lt;/h3&gt;
&lt;p&gt;Number of results: <span class="bold"><strong>{
 count(collection('/products')//product[ . contains text { $param:query } all words ])
}</strong></span>&lt;/p&gt;
&lt;/body&gt;</pre><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e3038"></a>4.3.1.&nbsp;Creating an XQuery webApp</h4></div></div></div><p>Page templates are XQuery scripts with the <code class="filename">.xqsp</code> extension. This extension is not hardcoded, it is corresponds to a mapping to the XQSPServlet. It can be changed if desired (in file web.xml).</p><p>Except for this point, a XQuery webApp is very similar to any other web application.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="bind_http_params"></a>4.3.2.&nbsp;Parameters</h4></div></div></div><p>Parameters for each elementary request are specified through global XQuery variables:</p><pre class="programlisting">declare variable $param:client-name as xs:string external;
declare variable $param:year as xs:integer external;
...</pre><div class="orderedlist"><ol type="1"><li><p>The name of a parameter must use the predefined namespace prefix <code class="varname">param</code>.</p></li><li><p>A parameter may have a default value:</p><pre class="programlisting">declare variable $param:year as xs:integer := 2010;</pre><p>A parameter with a default value needs not be specified in the request.</p><p>An execution error happens on use of a parameter without default value and not specified in the request.</p></li><li><p>A parameter may have a type declaration. If not defined, the actual type is xs:string.</p><p>If the type is specified, the value of the parameter can be converted from the string representation to the specified type.</p><p><span class="bold"><strong>Special case</strong></span>: if type node() or element() is specified, the value is considered XML and parsed into a node. In practice, only XML types node(), element() and document-node() can be passed this way (because of parsing): attribute, comment, processing-instruction, text nodes are not supported.</p></li><li><p>If a parameter has no type:</p><p>if it is not a multipart File (i.e using GET or POST form-urlencoded), then the value is converted to String (xs:string).</p><p>Otherwise (multipart File) no conversion happens, the parameter is not bound. This is reserved for future use.</p></li></ol></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e3087"></a>4.3.3.&nbsp;Result content-type and output options</h4></div></div></div><p>To define the way results are formatted in the response, XQ webApps use XQuery options in the declaration part of each query.</p><p>Example:</p><pre class="programlisting">  declare option output:encoding "UTF-8";</pre><p>Available options:</p><p>These are the common serialization options (see section <a class="link" href="general_extensions.html#serial_func">Serialization</a><em class="wordasword">)</em>, preceded by the <span class="command"><strong>output:</strong></span> prefix. This prefix is predefined (this is actually a XQuery 1.1 feature).</p><p>Most important options are:</p><div class="orderedlist"><ol type="1"><li><p><span class="bold"><strong>method</strong></span>: standard values "HTML", "XHTML", "XML" and "TEXT".</p></li><li><p><span class="bold"><strong>encoding</strong></span>: values like "UTF-8", "ISO-8859-15".</p></li><li><p><span class="bold"><strong>content-type</strong></span>: allows fine control on the mime type of the request response (header Content-Type).</p><p>Normally this value is deduced from the output method: for example text/html if method="HTML", etc. but in some circumstances you may want to use application-specific values like <code class="computeroutput">image/svg+xml</code>.</p></li></ol></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e3131"></a>4.3.4.&nbsp;Function API</h4></div></div></div><p>XQuery webApps come with an extensive set of extension functions, which are documented in the Reference chapter <a class="link" href="ch16.html#webapp_reference">"WebApp extension functions"</a>.</p><div class="itemizedlist"><ul type="disc"><li><p>Request functions, with prefix <em class="replaceable"><code>request:</code></em> provide access to the properties of an HTTP request: parameters, headers, query, remote user and host, cookies.</p></li><li><p>Response functions, with prefix <em class="replaceable"><code>response:</code></em> provide means of controlling the HTTP response.</p></li><li><p>Session functions, with prefix <em class="replaceable"><code>session:</code></em> handle a session and its associated data.</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e3158"></a>4.3.5.&nbsp;Modules and resources</h4></div></div></div><p>XQuery modules can be stored in several places:</p><div class="itemizedlist"><ul type="disc"><li><p>Inside the webapp directory (local modules).</p></li><li><p>in the directory 'modules' of the Qizx Server (global modules).</p></li><li><p>in the EXPath repository.</p></li></ul></div></div></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="getting_started.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="admin_guide.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="ch06.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter&nbsp;4.&nbsp;Getting started&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;Chapter&nbsp;6.&nbsp;Support of standard XQuery Update</td></tr></table></div></body></html>